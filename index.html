<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap"
      rel="stylesheet"
    />
    <title>Insider Loop - Start</title>
    <style>
      :root {
        color-scheme: dark;
        --bg: #05060a;
        --bg-deep: #020205;
        --neon-cyan: #22f3ff;
        --neon-pink: #ff4fd8;
        --neon-blue: #4d7cff;
        --neon-green: #28ff6b;
        --text-main: #e8f6ff;
        --text-muted: #9aa7c7;
        --panel: rgba(10, 16, 36, 0.82);
        --panel-border: rgba(34, 243, 255, 0.45);
        --glow: 0 0 18px rgba(34, 243, 255, 0.35);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "VT323", "Press Start 2P", monospace;
        background: radial-gradient(circle at top, rgba(77, 124, 255, 0.12), transparent 55%),
          radial-gradient(circle at 70% 20%, rgba(255, 79, 216, 0.1), transparent 50%),
          linear-gradient(180deg, var(--bg) 0%, var(--bg-deep) 100%);
        color: var(--text-main);
        overflow: hidden;
      }

      .stage {
        position: relative;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        padding: 28px clamp(20px, 5vw, 64px) 32px;
        gap: 24px;
        z-index: 1;
      }

      .stage::before {
        content: "";
        position: absolute;
        inset: 0;
        background: repeating-linear-gradient(
            0deg,
            rgba(255, 255, 255, 0.05) 0,
            rgba(255, 255, 255, 0.05) 1px,
            transparent 1px,
            transparent 3px
          ),
          repeating-linear-gradient(
            90deg,
            rgba(34, 243, 255, 0.04) 0,
            rgba(34, 243, 255, 0.04) 1px,
            transparent 1px,
            transparent 6px
          );
        opacity: 0.3;
        pointer-events: none;
        mix-blend-mode: screen;
        z-index: 0;
      }

      .stage::after {
        content: "";
        position: absolute;
        inset: -20% 0 0;
        background: radial-gradient(circle at 50% 0%, rgba(34, 243, 255, 0.25), transparent 55%);
        opacity: 0.6;
        pointer-events: none;
        z-index: 0;
      }

      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        position: relative;
        z-index: 2;
      }

      .title {
        font-family: "Press Start 2P", monospace;
        font-size: clamp(18px, 2vw, 24px);
        letter-spacing: 2px;
        text-transform: uppercase;
        text-shadow: 0 0 12px rgba(34, 243, 255, 0.65);
      }

      .toggles {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      .toggle {
        font-family: "Press Start 2P", monospace;
        font-size: 12px;
        padding: 10px 16px;
        border: 1px solid var(--panel-border);
        background: rgba(5, 8, 20, 0.8);
        color: var(--text-main);
        text-transform: uppercase;
        box-shadow: var(--glow);
        cursor: pointer;
        transition: border-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
      }

      .toggle.off {
        color: var(--text-muted);
        border-color: rgba(154, 167, 199, 0.4);
        box-shadow: none;
      }

      .hero {
        flex: 1;
        display: grid;
        align-items: center;
        gap: 24px;
        grid-template-columns: minmax(0, 1fr);
        position: relative;
        z-index: 2;
      }

      .hero-panel {
        background: var(--panel);
        border: 1px solid var(--panel-border);
        padding: clamp(24px, 4vw, 48px);
        box-shadow: 0 0 40px rgba(6, 150, 255, 0.15);
        backdrop-filter: blur(6px);
      }

      .hero h1 {
        margin: 0 0 16px;
        font-family: "Press Start 2P", monospace;
        font-size: clamp(28px, 4vw, 48px);
        line-height: 1.2;
        color: var(--neon-cyan);
        text-shadow: 0 0 16px rgba(34, 243, 255, 0.55);
      }

      .hero p {
        margin: 0 0 24px;
        font-size: clamp(20px, 2.4vw, 26px);
        color: var(--text-muted);
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
      }

      .btn {
        font-family: "Press Start 2P", monospace;
        font-size: 14px;
        padding: 16px 22px;
        border: 1px solid transparent;
        cursor: pointer;
        text-transform: uppercase;
        transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--neon-blue), var(--neon-cyan));
        color: #03040a;
        box-shadow: 0 0 20px rgba(34, 243, 255, 0.5);
      }

      .btn-secondary {
        background: rgba(8, 16, 40, 0.8);
        color: var(--text-main);
        border: 1px solid var(--panel-border);
      }

      .btn:hover,
      .btn:focus-visible {
        transform: translateY(-2px);
      }

      .hint {
        margin-top: 24px;
        font-size: 18px;
        color: var(--text-muted);
      }

      .overlay {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.92);
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition: opacity 0.6s ease, visibility 0s linear 0.6s;
        z-index: 1000;
      }

      #game-preload {
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        pointer-events: none;
        border: 0;
        z-index: 500;
        transition: opacity 0.4s ease;
      }

      #game-preload.is-active {
        opacity: 1;
        pointer-events: auto;
      }

      .overlay.is-visible {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
        transition: opacity 0.6s ease;
      }

      #week-overlay .week-text {
        font-family: "Press Start 2P", monospace;
        font-size: clamp(24px, 4vw, 48px);
        color: var(--neon-green);
        letter-spacing: 2px;
        text-shadow: 0 0 18px rgba(40, 255, 107, 0.6);
      }

      #week-overlay {
        background: #000;
        z-index: 3000;
      }

      .stage.is-hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition: opacity 0.4s ease, visibility 0s linear 0.4s;
      }

      #week-overlay.fade-out {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition: opacity 1.2s ease;
      }

      .credits-card {
        width: min(520px, 90vw);
        background: rgba(6, 10, 28, 0.95);
        border: 1px solid var(--panel-border);
        padding: clamp(24px, 4vw, 32px);
        box-shadow: 0 0 30px rgba(255, 79, 216, 0.25);
        text-align: center;
        display: grid;
        gap: 16px;
      }

      .leaderboard-card {
        width: min(680px, 92vw);
        text-align: left;
        gap: 12px;
      }

      .leaderboard-status {
        font-size: 16px;
        color: var(--text-muted);
        min-height: 18px;
      }

      .leaderboard-list {
        display: grid;
        gap: 10px;
        max-height: min(52vh, 520px);
        overflow: auto;
        padding-right: 4px;
      }

      .leaderboard-row {
        display: grid;
        grid-template-columns: 44px minmax(0, 1fr) 120px;
        gap: 12px;
        align-items: center;
        padding: 12px 14px;
        border: 1px solid rgba(34, 243, 255, 0.2);
        background: rgba(5, 8, 20, 0.65);
      }

      .leaderboard-rank {
        font-family: "Press Start 2P", monospace;
        font-size: 12px;
        color: var(--neon-cyan);
        text-shadow: 0 0 14px rgba(34, 243, 255, 0.55);
      }

      .leaderboard-player {
        font-size: 18px;
        color: var(--text-main);
        letter-spacing: 1px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .leaderboard-score {
        text-align: right;
        font-family: "Press Start 2P", monospace;
        font-size: 12px;
        color: var(--neon-green);
        text-shadow: 0 0 16px rgba(40, 255, 107, 0.5);
      }

      .rank-1 {
        color: #ffd700;
      }
      .rank-2 {
        color: #c0c0c0;
      }
      .rank-3 {
        color: #cd7f32;
      }

      .leaderboard-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        flex-wrap: wrap;
        margin-top: 4px;
      }

      .credits-card h2 {
        margin: 0;
        font-family: "Press Start 2P", monospace;
        font-size: 22px;
        color: var(--neon-pink);
      }

      .credits-card a {
        color: var(--neon-cyan);
        text-decoration: none;
      }

      .footer {
        font-size: 16px;
        color: var(--text-muted);
        text-align: right;
      }

      @media (max-width: 640px) {
        .toggle {
          font-size: 10px;
          padding: 8px 12px;
        }

        .btn {
          width: 100%;
        }

        .footer {
          text-align: left;
        }

        .leaderboard-row {
          grid-template-columns: 38px minmax(0, 1fr) 96px;
          padding: 10px 12px;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          transition: none !important;
          animation: none !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="stage" id="start-stage">
      <header>
        <div class="title">INSIDER LOOP</div>
        <div class="toggles">
          <button class="toggle" id="lang-toggle" type="button">EN</button>
          <button class="toggle" id="bgm-toggle" type="button">BGM: ON</button>
          <button class="toggle" id="sfx-toggle" type="button">SFX: ON</button>
        </div>
      </header>

      <main class="hero">
        <section class="hero-panel">
          <h1>Insider Loop</h1>
          <p>准备好后点击开始，进入挑战。</p>
          <div class="actions">
            <button class="btn btn-primary" id="start-btn" type="button">开始游戏</button>
            <button class="btn btn-secondary" id="credits-btn" type="button">制作人员</button>
            <button class="btn btn-secondary" id="leaderboard-btn" type="button">排行榜</button>
          </div>
          <div class="hint">提示：音效与背景音乐可随时开关。</div>
        </section>
      </main>

      <div class="footer">Version: Prototype</div>
    </div>

    <div class="overlay" id="week-overlay" aria-hidden="true">
      <div class="week-text">第一周....</div>
    </div>

    <div class="overlay" id="credits-overlay" aria-hidden="true">
      <div class="credits-card">
        <h2>制作人员</h2>
        <div>
          @beiyue66 -
          <a href="https://x.com/beiyue66" target="_blank" rel="noreferrer">访问推特</a>
        </div>
        <button class="btn btn-secondary" id="credits-close" type="button">关闭</button>
      </div>
    </div>

    <div class="overlay" id="leaderboard-overlay" aria-hidden="true">
      <div class="credits-card leaderboard-card">
        <h2 id="leaderboard-title">排行榜</h2>
        <div class="leaderboard-status" id="leaderboard-status"></div>
        <div class="leaderboard-list" id="leaderboard-list" role="list"></div>
        <div class="leaderboard-actions">
          <button class="btn btn-secondary" id="leaderboard-refresh" type="button">刷新</button>
          <button class="btn btn-secondary" id="leaderboard-close" type="button">关闭</button>
        </div>
      </div>
    </div>

    <iframe id="game-preload" src="/game.html" title="game-preload" aria-hidden="true"></iframe>
    <audio id="bgm" src="/audio/bgm.mp3" loop></audio>
    <audio id="sfx-start" src="/audio/start.wav"></audio>

    <script>
      const startButton = document.getElementById("start-btn");
      const creditsButton = document.getElementById("credits-btn");
      const creditsOverlay = document.getElementById("credits-overlay");
      const creditsClose = document.getElementById("credits-close");
      const leaderboardButton = document.getElementById("leaderboard-btn");
      const leaderboardOverlay = document.getElementById("leaderboard-overlay");
      const leaderboardClose = document.getElementById("leaderboard-close");
      const leaderboardRefresh = document.getElementById("leaderboard-refresh");
      const leaderboardStatus = document.getElementById("leaderboard-status");
      const leaderboardList = document.getElementById("leaderboard-list");
      const leaderboardTitle = document.getElementById("leaderboard-title");
      const weekOverlay = document.getElementById("week-overlay");
      const bgmToggle = document.getElementById("bgm-toggle");
      const sfxToggle = document.getElementById("sfx-toggle");
      const langToggle = document.getElementById("lang-toggle");
      const bgmAudio = document.getElementById("bgm");
      const startSfx = document.getElementById("sfx-start");
      const gameFrame = document.getElementById("game-preload");

      let bgmEnabled = true;
      let sfxEnabled = true;
      let userInteracted = false;
      let currentLang = localStorage.getItem('lang') || 'zh';
      let leaderboardLoading = false;
      let leaderboardAbort = null;

      // 多语言文本
      const i18n = {
        zh: {
          subtitle: '准备好后点击开始，进入挑战。',
          startGame: '开始游戏',
          credits: '制作人员',
          leaderboard: '排行榜',
          leaderboardTitle: '排行榜',
          leaderboardLoading: '正在加载...',
          leaderboardEmpty: '暂无数据（先通关并上传分数）',
          leaderboardError: '加载失败，请稍后重试',
          leaderboardRefresh: '刷新',
          close: '关闭',
          rank: '排名',
          player: '玩家',
          score: '分数',
          hint: '提示：音效与背景音乐可随时开关。',
          weekText: '第一周....'
        },
        en: {
          subtitle: 'Ready? Click start to begin the challenge.',
          startGame: 'Start Game',
          credits: 'Credits',
          leaderboard: 'Leaderboard',
          leaderboardTitle: 'Leaderboard',
          leaderboardLoading: 'Loading...',
          leaderboardEmpty: 'No entries yet (win and upload your score first).',
          leaderboardError: 'Failed to load. Please retry.',
          leaderboardRefresh: 'Refresh',
          close: 'Close',
          rank: 'Rank',
          player: 'Player',
          score: 'Score',
          hint: 'Tip: BGM and SFX can be toggled anytime.',
          weekText: 'Week 1....'
        }
      };

      function updateLanguage() {
        const t = i18n[currentLang];
        document.querySelector('.hero-panel p').textContent = t.subtitle;
        startButton.textContent = t.startGame;
        creditsButton.textContent = t.credits;
        leaderboardButton.textContent = t.leaderboard;
        document.querySelector('.hint').textContent = t.hint;
        document.querySelector('.week-text').textContent = t.weekText;
        langToggle.textContent = currentLang === 'zh' ? 'EN' : '中文';
        leaderboardTitle.textContent = t.leaderboardTitle;
        leaderboardRefresh.textContent = t.leaderboardRefresh;
        leaderboardClose.textContent = t.close;
      }

      function updateToggle(button, enabled, label) {
        button.classList.toggle("off", !enabled);
        button.textContent = `${label}: ${enabled ? "ON" : "OFF"}`;
      }

      function goToGame() {
        gameFrame.classList.add("is-active");
        if (gameFrame.contentWindow) {
          gameFrame.contentWindow.focus();
        }
      }

      function showWeekSequence() {
        document.getElementById("start-stage").classList.add("is-hidden");
        goToGame();
        weekOverlay.classList.add("is-visible");
        weekOverlay.setAttribute("aria-hidden", "false");
        setTimeout(() => {
          weekOverlay.classList.add("fade-out");
        }, 2000);
        setTimeout(() => {
          weekOverlay.classList.remove("is-visible");
          weekOverlay.setAttribute("aria-hidden", "true");
        }, 3200);
      }

      function playStartSound() {
        if (!sfxEnabled) return;
        startSfx.currentTime = 0;
        startSfx.play().catch(() => {});
      }

      function playBgmIfAllowed() {
        if (!bgmEnabled || !userInteracted) return;
        bgmAudio.play().catch(() => {});
      }

      updateToggle(bgmToggle, bgmEnabled, "BGM");
      updateToggle(sfxToggle, sfxEnabled, "SFX");
      updateLanguage();

      langToggle.addEventListener("click", () => {
        currentLang = currentLang === 'zh' ? 'en' : 'zh';
        localStorage.setItem('lang', currentLang);
        updateLanguage();
      });

      startButton.addEventListener("click", () => {
        userInteracted = true;
        playStartSound();
        playBgmIfAllowed();
        document.getElementById("start-stage").classList.add("is-hidden");
        goToGame();
      });

      creditsButton.addEventListener("click", () => {
        creditsOverlay.classList.add("is-visible");
        creditsOverlay.setAttribute("aria-hidden", "false");
      });

      creditsClose.addEventListener("click", () => {
        creditsOverlay.classList.remove("is-visible");
        creditsOverlay.setAttribute("aria-hidden", "true");
      });

      function formatAddress(address) {
        if (!address || address.length < 8) return address || '';
        return `${address.slice(0, 4)}...${address.slice(-4)}`;
      }

      function setLeaderboardStatus(text, isError) {
        leaderboardStatus.textContent = text || '';
        leaderboardStatus.style.color = isError ? 'var(--neon-pink)' : 'var(--text-muted)';
      }

      function renderLeaderboard(entries) {
        leaderboardList.innerHTML = '';
        if (!entries || entries.length === 0) return;

        for (let i = 0; i < entries.length; i += 1) {
          const entry = entries[i];
          const row = document.createElement('div');
          row.className = 'leaderboard-row';
          row.setAttribute('role', 'listitem');

          const rank = document.createElement('div');
          rank.className = `leaderboard-rank rank-${i + 1}`;
          rank.textContent = String(i + 1);

          const player = document.createElement('div');
          player.className = 'leaderboard-player';
          player.textContent = formatAddress(entry.player);

          const score = document.createElement('div');
          score.className = 'leaderboard-score';
          score.textContent = `$${Number(entry.score || 0).toFixed(2)}`;

          row.appendChild(rank);
          row.appendChild(player);
          row.appendChild(score);
          leaderboardList.appendChild(row);
        }
      }

      async function solanaRpc(endpoint, method, params, signal) {
        const body = {
          jsonrpc: '2.0',
          id: 1,
          method,
          params
        };

        const res = await fetch(endpoint, {
          method: 'POST',
          headers: { 'content-type': 'application/json' },
          body: JSON.stringify(body),
          signal
        });
        if (!res.ok) throw new Error(`RPC HTTP ${res.status}`);
        const json = await res.json();
        if (json.error) throw new Error(json.error.message || 'RPC error');
        return json.result;
      }

      function safeJsonParse(text) {
        try {
          return JSON.parse(text);
        } catch (e) {
          return null;
        }
      }

      async function fetchLeaderboardEntries(signal) {
        const RPC_ENDPOINT = 'https://api.devnet.solana.com';
        const MEMO_PROGRAM = 'MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr';
        const GAME_ID = 'stock-card-master';
        const SIGNATURE_LIMIT = 25;
        const MAX_ENTRIES = 20;

        const sigInfos = await solanaRpc(
          RPC_ENDPOINT,
          'getSignaturesForAddress',
          [MEMO_PROGRAM, { limit: SIGNATURE_LIMIT }],
          signal
        );
        const signatures = (sigInfos || []).map((s) => s.signature).filter(Boolean);
        if (signatures.length === 0) return [];

        // Some public RPCs don't implement getParsedTransactions. Fallback to per-tx getTransaction.
        let txs = null;
        try {
          txs = await solanaRpc(
            RPC_ENDPOINT,
            'getParsedTransactions',
            [signatures, { maxSupportedTransactionVersion: 0, commitment: 'confirmed' }],
            signal
          );
        } catch (e) {
          txs = null;
        }

        if (!Array.isArray(txs)) {
          const fetched = [];
          for (let i = 0; i < signatures.length; i += 1) {
            const sig = signatures[i];
            try {
              const tx = await solanaRpc(
                RPC_ENDPOINT,
                'getTransaction',
                [sig, { maxSupportedTransactionVersion: 0, commitment: 'confirmed' }],
                signal
              );
              fetched.push(tx);
            } catch (e) {
              fetched.push(null);
            }
          }
          txs = fetched;
        }

        const entries = [];
        for (let i = 0; i < (txs || []).length; i += 1) {
          const tx = txs[i];
          if (!tx || !tx.transaction || !tx.transaction.message) continue;

          const accountKeys = tx.transaction.message.accountKeys || [];
          const payer = accountKeys[0]?.pubkey || accountKeys[0] || '';
          const player = typeof payer === 'string' ? payer : (payer?.toString ? payer.toString() : String(payer));

          // Prefer parsed instructions when available
          const instructions = tx.transaction.message.instructions || [];
          let matched = false;
          for (let j = 0; j < instructions.length; j += 1) {
            const ix = instructions[j];
            if (!ix) continue;
            if (ix.program === 'spl-memo' && typeof ix.parsed === 'string') {
              if (!ix.parsed.includes(GAME_ID)) continue;
              const data = safeJsonParse(ix.parsed);
              if (!data || data.game !== GAME_ID) continue;
              matched = true;
              entries.push({
                player,
                score: Number(data.score || 0),
                week: Number(data.week || 0),
                timestamp: Number(data.timestamp || 0),
                signature: signatures[i] || ''
              });
            }
          }

          // Fallback: parse memo from log messages (when instructions aren't parsed)
          if (!matched && tx.meta && Array.isArray(tx.meta.logMessages)) {
            for (let j = 0; j < tx.meta.logMessages.length; j += 1) {
              const log = tx.meta.logMessages[j];
              if (typeof log !== 'string' || !log.includes(GAME_ID)) continue;
              const m = log.match(/Program log: Memo \\(len \\d+\\): \\\"(.*)\\\"/);
              if (!m) continue;
              const data = safeJsonParse(m[1]);
              if (!data || data.game !== GAME_ID) continue;
              entries.push({
                player,
                score: Number(data.score || 0),
                week: Number(data.week || 0),
                timestamp: Number(data.timestamp || 0),
                signature: signatures[i] || ''
              });
              break;
            }
          }
        }

        entries.sort((a, b) => (b.score - a.score));
        return entries.slice(0, MAX_ENTRIES);
      }

      async function loadLeaderboard() {
        if (leaderboardLoading) return;

        leaderboardLoading = true;
        const t = i18n[currentLang];

        // show cached first (fast UI)
        try {
          const cachedRaw = localStorage.getItem('leaderboard_cache');
          if (cachedRaw) {
            const cached = safeJsonParse(cachedRaw);
            if (cached && Array.isArray(cached.entries) && cached.entries.length) {
              setLeaderboardStatus('');
              renderLeaderboard(cached.entries);
            }
          }
        } catch (e) {}

        setLeaderboardStatus(t.leaderboardLoading);

        if (leaderboardAbort) {
          try { leaderboardAbort.abort(); } catch (e) {}
        }
        leaderboardAbort = new AbortController();

        try {
          const timeout = setTimeout(() => {
            try { leaderboardAbort.abort(); } catch (e) {}
          }, 15000);

          const entries = await fetchLeaderboardEntries(leaderboardAbort.signal);
          clearTimeout(timeout);

          if (!entries || entries.length === 0) {
            leaderboardList.innerHTML = '';
            setLeaderboardStatus(t.leaderboardEmpty);
          } else {
            setLeaderboardStatus('');
            renderLeaderboard(entries);
            try {
              localStorage.setItem('leaderboard_cache', JSON.stringify({ ts: Date.now(), entries }));
            } catch (e) {}
          }
        } catch (e) {
          leaderboardList.innerHTML = '';
          const msg = (e && e.message) ? `${t.leaderboardError} (${e.message})` : t.leaderboardError;
          setLeaderboardStatus(msg, true);
        } finally {
          leaderboardLoading = false;
        }
      }

      leaderboardButton.addEventListener("click", () => {
        leaderboardOverlay.classList.add("is-visible");
        leaderboardOverlay.setAttribute("aria-hidden", "false");
        loadLeaderboard();
      });

      leaderboardClose.addEventListener("click", () => {
        leaderboardOverlay.classList.remove("is-visible");
        leaderboardOverlay.setAttribute("aria-hidden", "true");
      });

      leaderboardRefresh.addEventListener("click", () => {
        loadLeaderboard();
      });

      bgmToggle.addEventListener("click", () => {
        bgmEnabled = !bgmEnabled;
        updateToggle(bgmToggle, bgmEnabled, "BGM");
        if (!bgmEnabled) {
          bgmAudio.pause();
        } else {
          playBgmIfAllowed();
        }
      });

      sfxToggle.addEventListener("click", () => {
        sfxEnabled = !sfxEnabled;
        updateToggle(sfxToggle, sfxEnabled, "SFX");
      });
    </script>
  </body>
</html>
